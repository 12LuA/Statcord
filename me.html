<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>DisStat</title>

		<script src="./assets/main.js"></script>
		<script src="./assets/api.js"></script>
		<link rel="stylesheet" href="./assets/style.css">
		<link rel="stylesheet" href="./assets/dialog.css">
	</head>
	<body>
		<global-navbar></global-navbar>

		<h1>Your bots</h1>
		<main id="bots"></main>
		<script>
			const params = new URLSearchParams(location.search)
			if (localStorage.getItem("token") || params.has("code")) {
				if (params.has("code")) login(params.get("code"))
				async function load() {
					const bots = await getBotsByUser()
					bots.forEach(bot => {
						const botElement = document.createElement("bot-card")
						botElement.setAttribute("data-bot", JSON.stringify(bot))
						document.getElementById("bots").appendChild(botElement)
					})
				}
				load()
			} else {
				const redirect_uri = "https://" + location.host + "/me"
				const scopes = "identify"

				location.href = "https://discord.com/api/oauth2/authorize?client_id=1080913163077308436&redirect_uri=" + encodeURIComponent(redirect_uri) + "&prompt=none&response_type=code&scope=" + encodeURIComponent(scopes)
			}
		</script>

		<button onclick="openDialog(document.getElementById('add-dialog'))">Add your Bot</button>
		<div id="add-dialog" class="dialog">
			<div class="dialog-content">
				<span class="close">&times;</span>
				<h2 style="font-size: 30px;">Add a bot</h2>

				<label for="botid">Enter the Bot/Application ID</label>
				<input type="text" id="botid" onchange='getAvatar(this.value)' placeholder="685166801394335819">
				<img id="avatarpreview" src="https://cdn.discordapp.com/embed/avatars/0.png" width="100" height="100" alt="">

				<button onclick="addBot(document.getElementById('botid').value)">Add</button>
			</div>
		</div>
	</body>
</html>
